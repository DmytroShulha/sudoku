# ADR 005: Dependency Injection Framework

## Metadata
* **Status:** ACCEPTED
* **Date:** 2026-01-30
* **Deciders:** Dmytro Shulha
* **Stakeholders Consulted:** N/A

## 1. Context (The Forces)
The app requires a way to manage dependencies across layers (Presentation, Domain, Data) to ensure testability and loose coupling.

* **Business:** Need for a framework that is easy to set up and maintain to keep development velocity high.
* **Technological:** Kotlin-first project. We want to avoid excessive annotation processing (KAPT/KSP) if possible to maintain fast build times.
* **Project-local:** A small to medium-sized project where complex Dagger-like features are not yet required.

## 2. Options Considered
* **Option 1: Koin**
  * **Pros/Cons:** Pure Kotlin, no code generation, very lightweight, easy to learn, and great Compose integration. However, it lacks compile-time safety (runtime errors if a dependency is missing).
* **Option 2: Hilt (Dagger)**
  * **Pros/Cons:** Compile-time safety, official Google recommendation, built on Dagger. However, it adds significant build time overhead due to annotation processing and has a steeper learning curve.
* **Option 3: Manual DI**
  * **Pros/Cons:** Zero dependencies, complete control. However, leads to significant boilerplate as the project grows.

## 3. Decision Outcome
**Chosen Option: Koin**

* **Rationale:** Koin's simplicity and Kotlin-centric approach match the "Package-based Clean Architecture" (ADR-000). It allows us to define modules quickly and provides excellent DSL for Compose. For a project of this scale, the trade-off of runtime vs. compile-time checks is acceptable in exchange for developer productivity.
* **Rejected Options:** Hilt was rejected to avoid the complexity and build-time impact of Dagger/annotation processing. Manual DI was rejected to prevent "boilerplate bloat" in the Application class and Feature Entries.

## 4. Consequences
* **{+} Positive:** Extremely fast setup and low boilerplate.
* **{+} Positive:** No impact on build times (no KAPT/KSP required for DI).
* **{+} Positive:** Easy testing with `KoinTest`.
* **{-} Negative:** Risk of runtime crashes if a dependency is not properly registered (mitigated by `checkModules` tests).

## 5. Validation & Compliance
* Use `checkModules` in unit tests to verify the Koin graph.
* Code reviews to ensure dependencies are provided via modules and not manually instantiated.

## 6. Links & References
* [Koin Documentation](https://insert-koin.io/)
* [PersonalDi.kt](../../app/src/main/java/org/dsh/personal/sudoku/PersonalDi.kt)
* Back to [Log](../adl.md)
