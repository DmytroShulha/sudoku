# ADR 001: App Storage

## Metadata
* **Status:** ACCEPTED
* **Date:** 2026-01-28
* **Deciders:** Dmytro Shulha
* **Stakeholders Consulted:** N/A

## 1. Context (The Forces)
We need to persist game statistics, user settings, and the state of the current game across app sessions.

* **Business:** Requirements to store game stats, settings and current game.
* **Technological:** Need for both relational data storage (for stats) and simple key-value or object storage (for settings and state). SharedPreferences is deprecated.
* **Project-local:** N/A

## 2. Options Considered
* **Option 1: Room for everything**
  * **Pros/Cons:** Strong consistency and relational support, but high boilerplate for simple settings.
* **Option 2: DataStore (Preferences/Proto) for everything**
  * **Pros/Cons:** Good for simple values, but difficult to query or scale for complex statistics.
* **Option 3: Hybrid (Room + DataStore)**
  * **Pros/Cons:** Uses the right tool for each job; relational for stats, reactive/simple for settings.
* **Option 4: SQLDelight, NoSQL (e.g., Realm), or simple SQLite**
  * **Pros/Cons:** SQLDelight provides type-safe SQL but requires more manual setup. NoSQL is easy to use but adds library size and vendor lock-in. Simple SQLite is too low-level and error-prone compared to Room.

## 3. Decision Outcome
**Chosen Option: Hybrid (Room + DataStore)**

* **Rationale:** 
    * For game statistic use: **Room** (allows relational queries and expansion).
    * For current game use: **DataStore**.
    * For settings use: **DataStore** by serializing object into JSON.
* **Rejected Options:** 
  * **SharedPreferences** was rejected as it is deprecated and doesn't provide the same safety/API as DataStore. 
  * Using **Room** for everything was rejected to avoid unnecessary complexity for simple settings.
  * **SQLDelight** and **NoSQL** were rejected to keep dependencies standard (Google/AndroidX) and minimize initial setup overhead for a single-platform app.

## 4. Consequences
* **{+} Positive:** 2 storages allowing optimized storage for both relational data and single value/objects.
* **{+} Positive:** Room allows expanding the database schema easily as game stats become more complex.
* **{-} Negative:** Need to support and maintain two different persisted storage implementations.
* **{-} Negative:** DataStore storing complex objects via JSON serialization might be an issue with future migrations if the object expands significantly.

## 5. Validation & Compliance
* Code reviews to ensure data is routed to the correct storage based on its type.

## 6. Links & References
* Back to [Log](../adl.md)

