# ADR 004: CI/CD Strategy

## Metadata
* **Status:** ACCEPTED
* **Date:** 2026-01-30
* **Deciders:** Dmytro Shulha
* **Stakeholders Consulted:** N/A

## 1. Context (The Forces)
To ensure code quality, automate testing, and streamline the release process, we need a robust CI/CD pipeline. The project is hosted on GitHub, and we want to minimize context switching and infrastructure management.

* **Business:** Need for fast feedback on Pull Requests and automated delivery to the Play Store to reduce manual errors.
* **Technological:** Kotlin-based Android project requiring JDK 17, Gradle, and Android SDK environments.
* **Project-local:** GitHub is used for version control.

## 2. Options Considered
* **Option 1: GitHub Actions**
  * **Pros/Cons:** Native integration with GitHub VCS, easy to configure via YAML, vast marketplace for specialized actions (like Play Store upload), and no infra maintenance.
* **Option 2: Bitrise / CircleCI**
  * **Pros/Cons:** Mobile-specific optimizations and powerful UI for workflow management, but introduces external dependency and additional cost/configuration.
* **Option 3: Self-hosted Jenkins**
  * **Pros/Cons:** Maximum control over environment and costs for high-volume builds, but requires significant setup and maintenance overhead.

## 3. Decision Outcome
**Chosen Option: GitHub Actions**

* **Rationale:** Since the project is already on GitHub, using GitHub Actions provides the most seamless integration. It allows us to keep our CI definitions close to the code and leverage existing community actions for Android tasks (linting, testing, and Play Store publishing).
* **Implementation Details:**
    * **PR CI:** Runs on every Pull Request to validate build, run Lint, Detekt, unit tests, and generate JaCoCo coverage reports.
    * **Main/Release CI:** Automatically builds a release candidate AAB and signs it when code is merged to main or release branches.
    * **Manual Publish:** A workflow dispatch trigger allows manual deployment of specific refs to various Play Store tracks (internal, alpha, beta, production).

## 4. Consequences
* **{+} Positive:** Automatic quality gates on all Pull Requests (Lint + Tests).
* **{+} Positive:** Automated signing and artifact management reduces manual labor.
* **{+} Positive:** High visibility of build status directly within GitHub.
* **{-} Negative:** Build times are dependent on GitHub runner availability and performance.
* **{!} Risks/Tech Debt:** If build volume increases significantly, we may need to optimize Gradle caching or consider self-hosted runners to manage costs.

## 5. Validation & Compliance
* All Pull Requests must pass the `Build & Test PR` workflow before merging.
* Code coverage trends are monitored via the automated PR comments.

## 6. Links & References
* [GitHub Action](https://github.com/DmytroShulha/sudoku/actions)
* Current configs
  * [.github/workflows/pr-ci.yml](../../.github/workflows/pr-ci.yml)
  * [.github/workflows/main-and-release-ci.yml](../../.github/workflows/main-and-release-ci.yml)
  * [.github/workflows/manual-publish-playstore.yml](../../.github/workflows/manual-publish-playstore.yml)
* Back to [Log](../adl.md)
